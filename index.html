<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Michael Shoemate, Privacy Architect for the OpenDP Library" />
  <title>Intro to DP with OpenDP</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<style>
td {
    vertical-align: top;
}

.slide {
  font-size: 30pt;
}
</style>

<div class="background" style="float: right;"> 
    <img src="images/opendp-logo-scaled.png" style="padding: 0.5em;">
</div> 
<div class="slide titlepage">
  <h1 class="title">Intro to DP with OpenDP</h1>
  <p class="author">
Michael Shoemate, Privacy Architect for the OpenDP Library
  </p>
</div>
<div id="outline" class="slide section level2">
<h1>Outline</h1>
<ul>
<li>Introduction
<ul>
<li>What is Differential Privacy?</li>
</ul></li>
<li>DP Wizard
<ul>
<li>Live demo</li>
</ul></li>
<li>OpenDP Library
<ul>
<li>Context API</li>
<li>Tabular Data</li>
<li>Framework API</li>
<li>Programming Framework</li>
<li>Plugins</li>
</ul></li>
</ul>
</div>
<div id="what-is-differential-privacy" class="slide section level2">
<h1>What is Differential Privacy?</h1>
<p><em>Differential privacy</em> is a definition of privacy that
mathematically quantifies how much a data release can reveal about any
one person in the data.</p>
</div>
<div id="what-is-differential-privacy-1" class="slide section level2">
<h1>What is Differential Privacy?</h1>
<p><em>Differential privacy</em> is a definition of privacy that
mathematically quantifies how much a data release can reveal about any
one person in the data.</p>
<p>These data releases may be:</p>
<ul>
<li>descriptive statistics like counts, sums, means, quantiles</li>
<li>descriptive statistics under grouping, like contingency tables,
cross-tabulations</li>
<li>machine learning models</li>
<li>synthetic data</li>
<li>statistical models like regression, decision trees, PCA, etc</li>
</ul>
</div>
<div id="what-is-differential-privacy-2" class="slide section level2">
<h1>What is Differential Privacy?</h1>
<p><em>Differential privacy</em> is a definition of privacy that
mathematically quantifies how much a data release can reveal about any
one person in the data.</p>
<p>“Differential” in the sense that the technology obscures the
difference between data releases on data sets that differ by one
individual.</p>
</div>
<div id="what-is-differential-privacy-3" class="slide section level2">
<h1>What is Differential Privacy?</h1>
<p><em>Differential privacy</em> is a definition of privacy that
mathematically quantifies how much a data release can reveal about any
one person in the data.</p>
<p>Why we use it:</p>
<ul>
<li>Meaningful
<ul>
<li>Protects every individual</li>
<li>Robust against any adversary</li>
<li>Immune to auxiliary information</li>
</ul></li>
<li>Quantifiable
<ul>
<li>Bounded “privacy loss”</li>
<li>Mathematically rigorous</li>
<li>Allows for interactivity</li>
</ul></li>
</ul>
</div>
<div id="what-is-differential-privacy-4" class="slide section level2">
<h1>What is Differential Privacy?</h1>
<p><em>Differential privacy</em> is a definition of privacy that
mathematically quantifies how much a data release can reveal about any
one person in the data.</p>
<p>How it is applied:</p>
<ul>
<li>add a “small” amount of random noise into statistical
computations</li>
<li>careful application of data pre-processing when appropriate</li>
<li>and occasionally, completely replace with unexpected algorithms</li>
</ul>
<p>When implemented correctly, an estimator/algorithm/mechanism can be
shown to “satisfy” differential privacy.</p>
</div>
<div id="what-is-differential-privacy-5" class="slide section level2">
<h1>What is Differential Privacy?</h1>
<p><em>Differential privacy</em> is a definition of privacy that
mathematically quantifies how much a data release can reveal about any
one person in the data.</p>
<p>Example count algorithm:</p>
<ol style="list-style-type: decimal">
<li>compute number of records in dataset</li>
<li>add noise from the laplace distribution</li>
</ol>
<p>The “privacy loss” of sharing the outcome of this algorithm depends
on how many records an individual can contribute to the data, and how
much noise is added.</p>
</div>
<div id="dp-wizard" class="slide section level2">
<h1>DP Wizard</h1>
<p><a href="https://mccalluc-dp-wizard.share.connect.posit.cloud/">LIVE
DEMO</a></p>
</div>
<div id="opendp-library-setup" class="slide section level2">
<h1>OpenDP Library Setup</h1>
<p>First install and import the required dependencies:</p>
<pre class="shell"><code>%pip install opendp[mbi]</code></pre>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> opendp.prelude <span class="im">as</span> dp</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># The OpenDP team is working to vet algorithms used in these slides.</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Until that is complete we need to opt-in to use these features.</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dp.enable_features(<span class="st">&quot;contrib&quot;</span>)</span></code></pre></div>
</div>
<div id="example-dataset" class="slide section level2">
<h1>Example Dataset</h1>
<p><a
href="https://ec.europa.eu/eurostat/web/microdata/public-microdata/labour-force-survey">Labour
Force Survey microdata</a> released by Eurostat surveys working hours of
individuals in the European Union collected on a quarterly cadence</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lfs_data <span class="op">=</span> pl.scan_csv(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>...     dp.examples.get_france_lfs_path(), </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>...     ignore_errors<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p>Relevant columns:</p>
<ul>
<li>SEX: 1 | 2</li>
<li>AGE: integer</li>
<li>ILOSTAT: Labour status during the reference week</li>
<li>HWUSUAL: Number of Hours Per Week Usually Worked</li>
<li>QUARTER</li>
<li>YEAR</li>
</ul>
</div>
<div id="context-api" class="slide section level2">
<h1>Context API</h1>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>...    data<span class="op">=</span>lfs_data,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>...    privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>...    privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>... )</span></code></pre></div>
<ul>
<li>privacy unit: the greatest influence an individual may have on your
dataset
<ul>
<li>what the “protected change” is</li>
</ul></li>
<li>privacy loss: the greatest loss in privacy any one individual may
suffer in your dataset
<ul>
<li>how much advantage an adversary can gain from the release</li>
</ul></li>
</ul>
</div>
<div id="context-api-1" class="slide section level2">
<h1>Context API</h1>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>...    data<span class="op">=</span>lfs_data,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>...    privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>...    privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>... )</span></code></pre></div>
<ul>
<li>privacy unit: pessimistic upper bound based on the number of
quarters in the data
<ul>
<li>4 quarters across 9 years</li>
</ul></li>
<li>privacy loss: for central-DP with aggregate statistics,
<code>epsilon = 1</code> is the recommended default</li>
</ul>
</div>
<div id="context-api-2" class="slide section level2">
<h1>Context API</h1>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>...    data<span class="op">=</span>lfs_data,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>...    privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>...    privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>... )</span></code></pre></div>
<p>Intuition: Differential privacy is a specialized constraint on the
stability of a function.</p>
<p>Functional stability is a property that, given a bounded change in
the input to a function, you know the output has a bounded change.</p>
<p>Here, we set a bound on how much the input can change (the privacy
unit), and a bound on how much the output can change (the privacy
loss).</p>
</div>
<div id="context-api-3" class="slide section level2">
<h1>Context API</h1>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>...    data<span class="op">=</span>lfs_data,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>...    privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>...    privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>... )</span></code></pre></div>
<p>From here on, aim to create APIs similar to existing data science
libraries…</p>
</div>
<div id="dp-count" class="slide section level2">
<h1>DP Count</h1>
<p>A simple count of the number of individuals in the data.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_num_responses <span class="op">=</span> context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>).select(dp.<span class="bu">len</span>())</span></code></pre></div>
</div>
<div id="dp-count-1" class="slide section level2">
<h1>DP Count</h1>
<p>A simple count of the number of individuals in the data.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_num_responses <span class="op">=</span> context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>).select(dp.<span class="bu">len</span>())</span></code></pre></div>
<p>With statistical significance <code>alpha = 0.05</code>, or
equivalently with 95% confidence…</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_num_responses.summarize(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>shape: (<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>┌────────┬──────────────┬─────────────────┬───────┬────────────┐</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>│ column ┆ aggregate    ┆ distribution    ┆ scale ┆ accuracy   │</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>│ <span class="op">---</span>    ┆ <span class="op">---</span>          ┆ <span class="op">---</span>             ┆ <span class="op">---</span>   ┆ <span class="op">---</span>        │</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>│ <span class="bu">str</span>    ┆ <span class="bu">str</span>          ┆ <span class="bu">str</span>             ┆ f64   ┆ f64        │</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>╞════════╪══════════════╪═════════════════╪═══════╪════════════╡</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>│ <span class="bu">len</span>    ┆ Frame Length ┆ Integer Laplace ┆ <span class="fl">180.0</span> ┆ <span class="fl">539.731115</span> │</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>└────────┴──────────────┴─────────────────┴───────┴────────────┘</span></code></pre></div>
<p>…the true estimate will differ from the noisy estimate by at most
540.</p>
</div>
<div id="dp-count-2" class="slide section level2">
<h1>DP Count</h1>
<p>A simple count of the number of individuals in the data.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_num_responses <span class="op">=</span> context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>).select(dp.<span class="bu">len</span>())</span></code></pre></div>
<p>Assuming the privacy-utility tradeoff is acceptable, submit the
query:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_num_responses.release().collect() <span class="co"># doctest: +SKIP</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>shape: (<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>┌─────────┐</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>│ <span class="bu">len</span>     │</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>│ <span class="op">---</span>     │</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>│ u32     │</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>╞═════════╡</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>│ <span class="dv">3811915</span> │</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>└─────────┘</span></code></pre></div>
<p>This consumes a portion of the privacy budget.</p>
</div>
<div id="dp-sum" class="slide section level2">
<h1>DP Sum</h1>
<p>OpenDP properly accounts for all sources of numerical imprecision and
potential overflow in both the implementation of the function, as well
as in the privacy analysis.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>...    data<span class="op">=</span>lfs_data,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>...    privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>...    privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>...    margins<span class="op">=</span>[</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>...         dp.polars.Margin(</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>...             <span class="co"># the length of the data is no greater than</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>...             <span class="co">#    average quarterly survey size (public)</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>...             <span class="co">#    * number of quarters (public)</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>...             max_length<span class="op">=</span><span class="dv">150_000</span> <span class="op">*</span> <span class="dv">36</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>...             <span class="co"># Remember to only use public information</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>...         ),</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>...     ],</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>... )</span></code></pre></div>
<ul>
<li>Privacy guarantee is valid only if the data has at most
<code>max_length</code> records.</li>
<li>Recommended best practice is to only ever create one Context</li>
</ul>
</div>
<div id="dp-sum-1" class="slide section level2">
<h1>DP Sum</h1>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours <span class="op">=</span> (</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="fl">99.0</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>...     .select(pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.<span class="bu">sum</span>(bounds<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>... )</span></code></pre></div>
<p>Preprocessing:</p>
<ul>
<li>filter</li>
<li>cast</li>
<li>imputation</li>
<li>clipping</li>
</ul>
</div>
<div id="dp-sum-2" class="slide section level2">
<h1>DP Sum</h1>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours <span class="op">=</span> (</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="fl">99.0</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>...     .select(pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.<span class="bu">sum</span>(bounds<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>... )</span></code></pre></div>
<p>With 95% confidence, the DP sum release will differ from the exact
sum by at most 43,000.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours.summarize(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>shape: (<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>┌─────────┬───────────┬─────────────────┬─────────┬─────────────┐</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>│ column  ┆ aggregate ┆ distribution    ┆ scale   ┆ accuracy    │</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>       ┆ <span class="op">---</span>             ┆ <span class="op">---</span>     ┆ <span class="op">---</span>         │</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>       ┆ <span class="bu">str</span>             ┆ f64     ┆ f64         │</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>╞═════════╪═══════════╪═════════════════╪═════════╪═════════════╡</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>│ HWUSUAL ┆ Sum       ┆ Integer Laplace ┆ <span class="fl">14400.0</span> ┆ <span class="fl">43139.04473</span> │</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>└─────────┴───────────┴─────────────────┴─────────┴─────────────┘</span></code></pre></div>
</div>
<div id="dp-mean" class="slide section level2">
<h1>DP Mean</h1>
<p>The mean independently estimates a sum and a count:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours <span class="op">=</span> (</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="fl">99.0</span>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>...     .select(pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.mean(bounds<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>... )</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours.summarize(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>┌─────────┬───────────┬─────────────────┬─────────┬──────────────┐</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>│ column  ┆ aggregate ┆ distribution    ┆ scale   ┆ accuracy     │</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>       ┆ <span class="op">---</span>             ┆ <span class="op">---</span>     ┆ <span class="op">---</span>          │</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>       ┆ <span class="bu">str</span>             ┆ f64     ┆ f64          │</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>╞═════════╪═══════════╪═════════════════╪═════════╪══════════════╡</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>│ HWUSUAL ┆ Sum       ┆ Integer Laplace ┆ <span class="fl">28800.0</span> ┆ <span class="fl">86277.589474</span> │</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>│ HWUSUAL ┆ Length    ┆ Integer Laplace ┆ <span class="fl">360.0</span>   ┆ <span class="fl">1078.963271</span>  │</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>└─────────┴───────────┴─────────────────┴─────────┴──────────────┘</span></code></pre></div>
<p>The privacy budget allocated to this query is partitioned amongst the
two statistics.</p>
</div>
<div id="dp-mean-1" class="slide section level2">
<h1>DP Mean</h1>
<p>You can equivalently estimate the sum and count separately:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours <span class="op">=</span> (</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="fl">99.0</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>...     .select(</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>...        pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.<span class="bu">sum</span>(bounds<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">80</span>)), </span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>...        dp.<span class="bu">len</span>()</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>...     )</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>... )</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_work_hours.summarize(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>┌─────────┬──────────────┬─────────────────┬─────────┬──────────────┐</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>│ column  ┆ aggregate    ┆ distribution    ┆ scale   ┆ accuracy     │</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>          ┆ <span class="op">---</span>             ┆ <span class="op">---</span>     ┆ <span class="op">---</span>          │</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>          ┆ <span class="bu">str</span>             ┆ f64     ┆ f64          │</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>╞═════════╪══════════════╪═════════════════╪═════════╪══════════════╡</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>│ HWUSUAL ┆ Sum          ┆ Integer Laplace ┆ <span class="fl">28800.0</span> ┆ <span class="fl">86277.589474</span> │</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>│ <span class="bu">len</span>     ┆ Frame Length ┆ Integer Laplace ┆ <span class="fl">360.0</span>   ┆ <span class="fl">1078.963271</span>  │</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>└─────────┴──────────────┴─────────────────┴─────────┴──────────────┘</span></code></pre></div>
</div>
<div id="dp-mean-bounded-dp" class="slide section level2">
<h1>DP Mean (Bounded-DP)</h1>
<p>Under “Bounded-DP”, the number of records in the dataset is not
considered public information.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># apply domain descriptors (margins) to preprocessed data</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context_bounded_dp <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>...     <span class="co"># apply some preprocessing outside of OpenDP</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>...      <span class="co"># drops &quot;Not applicable&quot; values</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>...     data<span class="op">=</span>lfs_data.<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="dv">99</span>),</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>...     privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>...     privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>...     margins<span class="op">=</span>[</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>...         dp.polars.Margin(</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>...             max_length<span class="op">=</span><span class="dv">150_000</span> <span class="op">*</span> <span class="dv">36</span>,</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>...             <span class="co"># ADDITIONAL CODE STARTING HERE</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>...             <span class="co"># don&#39;t protect the total number of records (bounded-DP)</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>...             invariant<span class="op">=</span><span class="st">&quot;lengths&quot;</span>,</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>...         ),</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>...     ],</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>... )</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_mean_work_hours <span class="op">=</span> (</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>...     context_bounded_dp.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>...     .select(pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.mean(bounds<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>... )</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_mean_work_hours.summarize(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>┌─────────┬───────────┬─────────────────┬────────┬──────────────┐</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>│ column  ┆ aggregate ┆ distribution    ┆ scale  ┆ accuracy     │</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>       ┆ <span class="op">---</span>             ┆ <span class="op">---</span>    ┆ <span class="op">---</span>          │</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>       ┆ <span class="bu">str</span>             ┆ f64    ┆ f64          │</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>╞═════════╪═══════════╪═════════════════╪════════╪══════════════╡</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>│ HWUSUAL ┆ Sum       ┆ Integer Laplace ┆ <span class="fl">7200.0</span> ┆ <span class="fl">21569.772352</span> │</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>│ HWUSUAL ┆ Length    ┆ Integer Laplace ┆ <span class="fl">0.0</span>    ┆ NaN          │</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>└─────────┴───────────┴─────────────────┴────────┴──────────────┘</span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_mean_work_hours.release().collect() <span class="co"># doctest: +SKIP</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a>shape: (<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>┌───────────┐</span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>│ HWUSUAL   │</span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a>│ <span class="op">---</span>       │</span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a>│ f64       │</span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a>╞═══════════╡</span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a>│ <span class="fl">37.645122</span> │</span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a>└───────────┘</span></code></pre></div>
</div>
<div id="dp-quantile" class="slide section level2">
<h1>DP Quantile</h1>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> candidates <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">20</span>, <span class="dv">60</span>))</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_multi_quantiles <span class="op">=</span> (</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="fl">99.0</span>)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>...     .select(</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>...         pl.col.HWUSUAL.dp.quantile(a, candidates).alias(<span class="ss">f&quot;</span><span class="sc">{</span>a<span class="sc">}</span><span class="ss">-Quantile&quot;</span>)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>...         <span class="cf">for</span> a <span class="kw">in</span> [<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>]</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>...     )</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>... )</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_multi_quantiles.summarize()</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>shape: (<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>┌───────────────┬───────────────┬────────────────┬────────┐</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>│ column        ┆ aggregate     ┆ distribution   ┆ scale  │</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>│ <span class="op">---</span>           ┆ <span class="op">---</span>           ┆ <span class="op">---</span>            ┆ <span class="op">---</span>    │</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>│ <span class="bu">str</span>           ┆ <span class="bu">str</span>           ┆ <span class="bu">str</span>            ┆ f64    │</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>╞═══════════════╪═══════════════╪════════════════╪════════╡</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>│ <span class="fl">0.25</span><span class="op">-</span>Quantile ┆ <span class="fl">0.25</span><span class="op">-</span>Quantile ┆ ExponentialMin ┆ <span class="fl">3240.0</span> │</span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>│ <span class="fl">0.5</span><span class="op">-</span>Quantile  ┆ <span class="fl">0.5</span><span class="op">-</span>Quantile  ┆ ExponentialMin ┆ <span class="fl">1080.0</span> │</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>│ <span class="fl">0.75</span><span class="op">-</span>Quantile ┆ <span class="fl">0.75</span><span class="op">-</span>Quantile ┆ ExponentialMin ┆ <span class="fl">3240.0</span> │</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>└───────────────┴───────────────┴────────────────┴────────┘</span></code></pre></div>
</div>
<div id="dp-grouping" class="slide section level2">
<h1>DP Grouping</h1>
<ul>
<li>Stable Keys
<ul>
<li>Privacy: Costs an extra “delta” privacy parameter</li>
<li>Utility: Must release counts, discards keys with small counts</li>
</ul></li>
<li>Explicit Keys
<ul>
<li>Privacy: No extra “delta” privacy parameter</li>
<li>Utility: Joins against the explicit key set, imputes missing
keys</li>
</ul></li>
</ul>
</div>
<div id="dp-grouping-with-stable-keys" class="slide section level2">
<h1>DP Grouping with Stable Keys</h1>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>...     data<span class="op">=</span>lfs_data,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>...     privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">36</span>),</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>...     privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">1e-7</span>),</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>...     margins<span class="op">=</span>[dp.polars.Margin(max_length<span class="op">=</span><span class="dv">150_000</span> <span class="op">*</span> <span class="dv">36</span>)],</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>... )</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_age_ilostat <span class="op">=</span> (</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">1e-7</span>)</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>...     .group_by(<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;ILOSTAT&quot;</span>)</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>...     .agg(dp.<span class="bu">len</span>())</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>... )</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_age_ilostat.summarize()</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>shape: (<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>┌────────┬──────────────┬─────────────────┬───────┬───────────┐</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>│ column ┆ aggregate    ┆ distribution    ┆ scale ┆ threshold │</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>│ <span class="op">---</span>    ┆ <span class="op">---</span>          ┆ <span class="op">---</span>             ┆ <span class="op">---</span>   ┆ <span class="op">---</span>       │</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>│ <span class="bu">str</span>    ┆ <span class="bu">str</span>          ┆ <span class="bu">str</span>             ┆ f64   ┆ u32       │</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>╞════════╪══════════════╪═════════════════╪═══════╪═══════════╡</span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>│ <span class="bu">len</span>    ┆ Frame Length ┆ Integer Laplace ┆ <span class="fl">180.0</span> ┆ <span class="dv">3458</span>      │</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>└────────┴──────────────┴─────────────────┴───────┴───────────┘</span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> df <span class="op">=</span> query_age_ilostat.release().collect()</span></code></pre></div>
<p><img src="images/stable_keys.png" alt="Stable Keys" width="800"/></p>
</div>
<div id="dp-grouping-with-explicit-keys" class="slide section level2">
<h1>DP Grouping with Explicit Keys</h1>
<p>Reusing the key-set released in the previous query:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_age_ilostat <span class="op">=</span> (</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>...     .group_by(<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;ILOSTAT&quot;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>...     .agg(pl.col.HWUSUAL.dp.<span class="bu">sum</span>((<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>...     .with_keys(df[<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;ILOSTAT&quot;</span>])</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>... )</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_age_ilostat.summarize()</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>shape: (<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>┌─────────┬───────────┬───────────────┬──────────────┐</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>│ column  ┆ aggregate ┆ distribution  ┆ scale        │</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>       ┆ <span class="op">---</span>           ┆ <span class="op">---</span>          │</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>       ┆ <span class="bu">str</span>           ┆ f64          │</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>╞═════════╪═══════════╪═══════════════╪══════════════╡</span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>│ HWUSUAL ┆ Sum       ┆ Float Laplace ┆ <span class="fl">14472.517992</span> │</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>└─────────┴───────────┴───────────────┴──────────────┘</span></code></pre></div>
</div>
<div id="pre-processing" class="slide section level2">
<h1>Pre-Processing</h1>
<p>Stable transformations in <code>with_columns</code>:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_hwusual_binned <span class="op">=</span> (</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>...     <span class="co"># shadows the usual work hours &quot;HWUSUAL&quot; column with binned data</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>...     .with_columns(pl.col.HWUSUAL.cut(breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">98</span>]))</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>...     .group_by(pl.col.HWUSUAL)</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>...     .agg(dp.<span class="bu">len</span>())</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>... )</span></code></pre></div>
</div>
<div id="pre-processing-1" class="slide section level2">
<h1>Pre-Processing</h1>
<p>Stable transformations in <code>group_by</code>:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_hwusual_binned <span class="op">=</span> (</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>...     .group_by(pl.col.HWUSUAL.cut(breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">98</span>]))</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>...     .agg(dp.<span class="bu">len</span>())</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>... )</span></code></pre></div>
</div>
<div id="pre-processing-2" class="slide section level2">
<h1>Pre-Processing</h1>
<ul>
<li>Data Types: int, float, string, bool, categorical, enum, datetime,
time</li>
<li>Boolean logic, binary operations</li>
<li>Cast, clip, cut, imputation, expression filtering, recoding</li>
<li>Date parsing and temporal logic</li>
</ul>
</div>
<div id="user-identifiers" class="slide section level2">
<h1>User Identifiers</h1>
<ul>
<li>individuals may make an unbounded number of contributions</li>
<li>all contributions from each user share the same identifier</li>
</ul>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># the PIDENT column contains individual identifiers</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># an individual may contribute data under at most 1 PIDENT identifier</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> privacy_unit <span class="op">=</span> dp.unit_of(</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>...     contributions<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>...     identifier<span class="op">=</span>pl.col(<span class="st">&quot;PIDENT&quot;</span>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>... )</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>...     data<span class="op">=</span>lfs_data,</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>...     privacy_unit<span class="op">=</span>privacy_unit,</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>...     privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>, delta<span class="op">=</span><span class="fl">1e-8</span>),</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>...     margins<span class="op">=</span>[dp.polars.Margin(max_length<span class="op">=</span><span class="dv">150_000</span> <span class="op">*</span> <span class="dv">36</span>)],</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>... )</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query <span class="op">=</span> (</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">1e-8</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="dv">99</span>)</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>...     .truncate_per_group(<span class="dv">10</span>)</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>...     .select(pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.mean((<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>... )</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query.summarize()</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>┌─────────┬───────────┬─────────────────┬────────┐</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>│ column  ┆ aggregate ┆ distribution    ┆ scale  │</span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>       ┆ <span class="op">---</span>             ┆ <span class="op">---</span>    │</span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>       ┆ <span class="bu">str</span>             ┆ f64    │</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>╞═════════╪═══════════╪═════════════════╪════════╡</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>│ HWUSUAL ┆ Sum       ┆ Integer Laplace ┆ <span class="fl">8000.0</span> │</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>│ HWUSUAL ┆ Length    ┆ Integer Laplace ┆ <span class="fl">100.0</span>  │</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>└─────────┴───────────┴─────────────────┴────────┘</span></code></pre></div>
</div>
<div id="truncating-per-group" class="slide section level2">
<h1>Truncating Per-Group</h1>
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query <span class="op">=</span> (</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">1e-8</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="dv">99</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>...     .group_by(pl.col.PIDENT) <span class="co"># truncation begins here</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>...     .agg(pl.col.HWUSUAL.mean()) <span class="co"># arbitrary expressions can be used here</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>...     .select(pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.mean((<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>... )</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query.summarize()</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>┌─────────┬───────────┬─────────────────┬───────┐</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>│ column  ┆ aggregate ┆ distribution    ┆ scale │</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>       ┆ <span class="op">---</span>             ┆ <span class="op">---</span>   │</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>       ┆ <span class="bu">str</span>             ┆ f64   │</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>╞═════════╪═══════════╪═════════════════╪═══════╡</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>│ HWUSUAL ┆ Sum       ┆ Integer Laplace ┆ <span class="fl">800.0</span> │</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>│ HWUSUAL ┆ Length    ┆ Integer Laplace ┆ <span class="fl">10.0</span>  │</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>└─────────┴───────────┴─────────────────┴───────┘</span></code></pre></div>
</div>
<div id="truncating-contributed-groups" class="slide section level2">
<h1>Truncating Contributed Groups</h1>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> quarterly <span class="op">=</span> [pl.col.QUARTER, pl.col.YEAR]</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query <span class="op">=</span> (</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>...     context.query(epsilon<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">5</span>, delta<span class="op">=</span><span class="fl">1e-8</span> <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="dv">99</span>)</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>...     .truncate_per_group(<span class="dv">1</span>, by<span class="op">=</span>quarterly)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>...     .truncate_num_groups(<span class="dv">10</span>, by<span class="op">=</span>quarterly)</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>...     .group_by(quarterly)</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>...     .agg(dp.<span class="bu">len</span>(), pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.<span class="bu">sum</span>((<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>... )</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query.summarize()</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>┌─────────┬──────────────┬─────────────────┬────────┬───────────┐</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>│ column  ┆ aggregate    ┆ distribution    ┆ scale  ┆ threshold │</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>          ┆ <span class="op">---</span>             ┆ <span class="op">---</span>    ┆ <span class="op">---</span>       │</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>          ┆ <span class="bu">str</span>             ┆ f64    ┆ u32       │</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>╞═════════╪══════════════╪═════════════════╪════════╪═══════════╡</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>│ <span class="bu">len</span>     ┆ Frame Length ┆ Integer Laplace ┆ <span class="fl">100.0</span>  ┆ <span class="dv">2165</span>      │</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>│ HWUSUAL ┆ Sum          ┆ Integer Laplace ┆ <span class="fl">8000.0</span> ┆ null      │</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>└─────────┴──────────────┴─────────────────┴────────┴───────────┘</span></code></pre></div>
</div>
<div id="zero-concentrated-dp-zcdp" class="slide section level2">
<h1>Zero-Concentrated DP (zCDP)</h1>
<ul>
<li>a weaker definition of privacy than pure-DP, but stronger than
approximate-DP</li>
<li>using zCDP causes OpenDP to change the noise distribution</li>
</ul>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> privacy_loss <span class="op">=</span> dp.loss_of(rho<span class="op">=</span><span class="fl">0.2</span>, delta<span class="op">=</span><span class="fl">1e-8</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>...     data<span class="op">=</span>lfs_data,</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>...     privacy_unit<span class="op">=</span>dp.unit_of(contributions<span class="op">=</span><span class="dv">1</span>, identifier<span class="op">=</span>pl.col(<span class="st">&quot;PIDENT&quot;</span>)),</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>...     privacy_loss<span class="op">=</span>privacy_loss,</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>...     margins<span class="op">=</span>[dp.polars.Margin(max_length<span class="op">=</span><span class="dv">150_000</span> <span class="op">*</span> <span class="dv">36</span>)],</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>... )</span></code></pre></div>
</div>
<div id="zero-concentrated-dp-zcdp-1" class="slide section level2">
<h1>Zero-Concentrated DP (zCDP)</h1>
<p>Re-running the previous query, but this time under zCDP:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> quarterly <span class="op">=</span> [pl.col.QUARTER, pl.col.YEAR]</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query <span class="op">=</span> (</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>...     context.query(rho<span class="op">=</span><span class="fl">0.2</span> <span class="op">/</span> <span class="dv">4</span>, delta<span class="op">=</span><span class="fl">1e-8</span> <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>...     .<span class="bu">filter</span>(pl.col.HWUSUAL <span class="op">!=</span> <span class="dv">99</span>)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>...     .truncate_per_group(<span class="dv">1</span>, by<span class="op">=</span>quarterly)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>...     .truncate_num_groups(<span class="dv">10</span>, by<span class="op">=</span>quarterly)</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>...     .group_by(quarterly)</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>...     .agg(dp.<span class="bu">len</span>(), pl.col.HWUSUAL.cast(<span class="bu">int</span>).dp.<span class="bu">sum</span>((<span class="dv">0</span>, <span class="dv">80</span>)))</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>... )</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query.summarize()</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>shape: (<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>┌─────────┬──────────────┬──────────────────┬────────────┬───────────┐</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>│ column  ┆ aggregate    ┆ distribution     ┆ scale      ┆ threshold │</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>│ <span class="op">---</span>     ┆ <span class="op">---</span>          ┆ <span class="op">---</span>              ┆ <span class="op">---</span>        ┆ <span class="op">---</span>       │</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a>│ <span class="bu">str</span>     ┆ <span class="bu">str</span>          ┆ <span class="bu">str</span>              ┆ f64        ┆ u32       │</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>╞═════════╪══════════════╪══════════════════╪════════════╪═══════════╡</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>│ <span class="bu">len</span>     ┆ Frame Length ┆ Integer Gaussian ┆ <span class="fl">14.142136</span>  ┆ <span class="dv">89</span>        │</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>│ HWUSUAL ┆ Sum          ┆ Integer Gaussian ┆ <span class="fl">1131.37085</span> ┆ null      │</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>└─────────┴──────────────┴──────────────────┴────────────┴───────────┘</span></code></pre></div>
</div>
<div id="laplace-vs.-gaussian-noise" class="slide section level2">
<h1>Laplace vs. Gaussian Noise</h1>
<p><img src="images/laplace-vs-gaussian.png" alt="Laplace vs Gaussian" width="80%"/></p>
<ul>
<li>Gaussian noise preserves the normality assumption</li>
<li>Gaussian noise cannot satisfy pure differential privacy
<ul>
<li>satisfies the weaker definition of approximate differential privacy
or zCDP</li>
</ul></li>
<li>Gaussian noise affords greater utility (adds less overall noise) for
a similar privacy guarantee when answering many queries</li>
<li>Sensitivity calibration
<ul>
<li>Laplace noise scale is proportional to the <span
class="math inline"><em>L</em><sub>1</sub></span> distance</li>
<li>Gaussian noise scale is proportional to the <span
class="math inline"><em>L</em><sub>2</sub></span> distance</li>
</ul></li>
</ul>
</div>
<div id="direct-use-of-mechanisms" class="slide section level2">
<h1>Direct Use of Mechanisms</h1>
<ul>
<li>The OpenDP Library is designed as a set of modular building
blocks</li>
<li>APIs to directly invoke lower-level mechanisms are available</li>
<li>Can be used for research purposes or plugged into existing
systems</li>
</ul>
</div>
<div id="laplace-mechanism-context-api" class="slide section level2">
<h1>Laplace Mechanism: Context API</h1>
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>...     data<span class="op">=</span>[<span class="fl">1.</span>, <span class="fl">4.</span>, <span class="fl">7.</span>],</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>...     privacy_unit<span class="op">=</span>dp.unit_of(l1<span class="op">=</span><span class="fl">1.</span>),</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>...     privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>...     domain<span class="op">=</span>dp.vector_domain(dp.atom_domain(T<span class="op">=</span><span class="bu">float</span>, nan<span class="op">=</span><span class="va">False</span>)),</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>... )</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_lap <span class="op">=</span> context.query(epsilon<span class="op">=</span><span class="dv">1</span>).laplace()</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_lap.param()</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="fl">1.0</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_lap.resolve()</span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>Measurement(</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>    input_domain   <span class="op">=</span> VectorDomain(AtomDomain(T<span class="op">=</span>f64)),</span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>    input_metric   <span class="op">=</span> L1Distance(f64),</span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>    output_measure <span class="op">=</span> MaxDivergence)</span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_lap.release() <span class="co"># doctest: +SKIP</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>[<span class="fl">0.7077237243471377</span>, <span class="fl">4.827747780105709</span>, <span class="fl">5.908376498290111</span>]</span></code></pre></div>
</div>
<div id="laplace-mechanism-framework-api" class="slide section level2">
<h1>Laplace Mechanism: Framework API</h1>
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_lap <span class="op">=</span> dp.m.make_laplace(</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>...     input_domain<span class="op">=</span>dp.vector_domain(dp.atom_domain(T<span class="op">=</span><span class="bu">float</span>, nan<span class="op">=</span><span class="va">False</span>)),</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>...     input_metric<span class="op">=</span>dp.l1_distance(T<span class="op">=</span><span class="bu">float</span>),</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>...     scale<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>... )</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_lap</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>Measurement(</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>    input_domain   <span class="op">=</span> VectorDomain(AtomDomain(T<span class="op">=</span>f64)),</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    input_metric   <span class="op">=</span> L1Distance(f64),</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>    output_measure <span class="op">=</span> MaxDivergence)</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_lap.<span class="bu">map</span>(d_in<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="fl">1.0</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_lap([<span class="fl">1.</span>, <span class="fl">4.</span>, <span class="fl">7.</span>]) <span class="co"># doctest: +SKIP</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>[<span class="fl">1.8894052083047814</span>, <span class="fl">5.543928329362439</span>, <span class="fl">6.961532708302391</span>]</span></code></pre></div>
</div>
<div id="randomized-response-context-api" class="slide section level2">
<h1>Randomized Response: Context API</h1>
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> context <span class="op">=</span> dp.Context.compositor(</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>...     data<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>...     privacy_unit<span class="op">=</span>dp.unit_of(local<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>...     privacy_loss<span class="op">=</span>dp.loss_of(epsilon<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>... )</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_rr <span class="op">=</span> context.query(epsilon<span class="op">=</span><span class="fl">1.0</span>).randomized_response_bool()</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_rr.param()</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="fl">0.7310585786300048</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_rr.resolve()</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>Measurement(</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>    input_domain   <span class="op">=</span> AtomDomain(T<span class="op">=</span><span class="bu">bool</span>),</span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>    input_metric   <span class="op">=</span> DiscreteDistance(),</span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>    output_measure <span class="op">=</span> MaxDivergence)</span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> query_rr.release() <span class="co"># doctest: +SKIP</span></span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a>[<span class="fl">0.7077237243471377</span>, <span class="fl">4.827747780105709</span>, <span class="fl">5.908376498290111</span>]</span></code></pre></div>
</div>
<div id="randomized-response-framework-api"
class="slide section level2">
<h1>Randomized Response: Framework API</h1>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_rr <span class="op">=</span> dp.m.make_randomized_response_bool(</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>...     prob<span class="op">=</span><span class="fl">0.7310585786300048</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>... )</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_rr</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>Measurement(</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    input_domain   <span class="op">=</span> AtomDomain(T<span class="op">=</span><span class="bu">bool</span>),</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    input_metric   <span class="op">=</span> DiscreteDistance(),</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>    output_measure <span class="op">=</span> MaxDivergence)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_rr.<span class="bu">map</span>(d_in<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="fl">0.9999999999999997</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m_rr(<span class="va">True</span>) <span class="co"># doctest: +SKIP</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="va">True</span></span></code></pre></div>
</div>
<div id="randomized-response-proof" class="slide section level2">
<h1>Randomized Response: Proof</h1>
<ul>
<li>Proofs demonstrate that the privacy guarantees hold.</li>
<li><a
href="https://docs.opendp.org/en/v0.13.0/proofs/rust/src/measurements/randomized_response/make_randomized_response_bool.pdf">Proof
document</a></li>
</ul>
</div>
<div id="programming-framework" class="slide section level2">
<h1>Programming Framework</h1>
<ul>
<li><a
href="https://docs.opendp.org/en/stable/theory/a-framework-to-understand-dp.html">A
Framework to Understand DP</a></li>
</ul>
<table>
<thead>
<tr>
<th>transformation</th>
<th>measurement</th>
<th>odometer</th>
</tr>
</thead>
<tbody>
<tr>
<td>input_domain</td>
<td>input_domain</td>
<td>input_domain</td>
</tr>
<tr>
<td>input_metric</td>
<td>input_metric</td>
<td>input_metric</td>
</tr>
<tr>
<td>function</td>
<td>function</td>
<td>function</td>
</tr>
<tr>
<td>output_domain</td>
<td></td>
<td></td>
</tr>
<tr>
<td>output_metric</td>
<td>output_measure</td>
<td>output_measure</td>
</tr>
<tr>
<td>stability_map</td>
<td>privacy_map</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div id="extensibility-plugins" class="slide section level2">
<h1>Extensibility: Plugins</h1>
<ul>
<li>Extend the library with your own algorithms implemented in Python or
Rust</li>
<li>Python and Rust algorithms can be mixed together</li>
<li>Examples:
<ul>
<li><a
href="https://docs.opendp.org/en/stable/api/user-guide/plugins/measurement.html">Constant
Mechanism</a></li>
<li><a
href="https://docs.opendp.org/en/stable/api/user-guide/plugins/theil-sen-regression.html">Theil-Sen
Regression</a></li>
<li>Hands-on Differential Privacy</li>
</ul></li>
</ul>
<p><img src="images/Hands-on-Differential-Privacy.png" alt="Book Cover" width="20%"/></p>
</div>
<div id="extensibility-supported-languages"
class="slide section level2">
<h1>Extensibility: Supported Languages</h1>
<table>
<thead>
<tr>
<th>language</th>
<th>functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td>Rust</td>
<td>core mechanisms, Polars, native transformations</td>
</tr>
<tr>
<td>Python</td>
<td>Rust functionality, Context API, Plugins, scikit-learn</td>
</tr>
<tr>
<td>R</td>
<td>Rust functionality (except Polars)</td>
</tr>
<tr>
<td>C</td>
<td>Rust functionality</td>
</tr>
</tbody>
</table>
</div>
<div id="conclusion" class="slide section level2">
<h1>Conclusion</h1>
<ul>
<li>Questions?</li>
<li>Join our <a
href="https://join.slack.com/t/opendp/shared_invite/zt-1aca9bm7k-hG7olKz6CiGm8htI2lxE8w">Slack</a></li>
<li><a href="opendp.org">opendp.org</a></li>
</ul>
<p><img src="images/opendp-website.png" alt="OpenDP Website" width="100%"/></p>
</div>
</body>
</html>
